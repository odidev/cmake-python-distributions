branches:
 only:
  - master
  - /^[0-9]+(\.[0-9]+)*(\.post[0-9]+)?$/
  - arm64_test

language: python

matrix:
  include:

    - os: osx
      language: generic
      env:
        - PYTHON_VERSION=3.7.4

    - os: osx
      language: generic
      env:
        - PYTHON_VERSION=2.7.15
    
    - os: linux
      arch: arm64
      dist: bionic
      sudo: required
      python: "3.7"
      env:
        - PYTHON_VERSION=3.7.4 PIP_NO_CACHE_DIR=on 

      before_deploy:
        - git config --global user.name "odidev"
        - git config --global user.email "odidev@puresoftware.com"
        - git config --global --list

      deploy:
        provider: pypi
        user: mkp2020
        password:
          secure: L1etBFaD0vbtiiaiSOw6D8zu8MHKwdEbzEz1anR6Nj/7kyylx1joy8Jz5T83lRTfXRnWyk9Np++M21J/TQKzn49TyaaBECtabMlg/n/JIufzhA27vXCDnwe3S2ERl4Au9yg+RRof+FJDWb/HrCaVkxvOUKKz+19PEUs73gtPSw9fCZI/PUvS8SpXL8/ltlKWhKw80Hs9WAVJ30m5iNy6a3BzfrW75eUSCQZjbt7B849LUZCosifE+a4rsWGu9R0gfAdWkn+4QYBa7s273wO7uJDkK/Vg32LwMIuB+9kzP/C35c/PQkrPg6EFkV04m8inALKew1NenPmL5cOkzxAazkKnzymi9Fe7wcGOd/OQ/UUfRjRV1AZmAEe93DWW7EPxNNwrac5TSll9KDnNWRrdZNALcnDOxDpOGTJUvYKfCSiUyjT/GkFxkZYbQN5YnkTDbMZeI5Yomw2IhgefMp4Pa90rIYIti+zkDSODyXPAVAWn9mt8UoCo6pe7YFBWSjfCd1MjJAIKu6CCzVAzscge8iExyce77J76WCZUAaJnozzZUx4Gul9xbjNNUX9BxAZHYyLcMX3lrSWRS86qjp/HAfCfC6Hr6NwUttLSqFyg1rRB9+Di+GqVWh0MKP4ndNqVfSXSsVpaKMRM5v7tk2BzYoQoWBbgXU373KCUicHKHnY=
        on:
          repo: odidev/cmake-python-distributions
          branch: master
        skip_cleanup: true
        distributions: sdist bdist_wheel --plat-name manylinux2014_aarch64

cache:
  directories:
    - $HOME/.pyenv/versions/3.7.4
    - $HOME/.pyenv/versions/2.7.15
    - $HOME/downloads

before_install:
  - if [[ "$TRAVIS_OS_NAME" == "osx" ]]; then mkdir $HOME/bin; ln -s $(which pip2) $HOME/bin/pip; ln -s $(which python2) $HOME/bin/python; fi
  - python scripts/ssl-check.py
  - python -m pip install --disable-pip-version-check --upgrade pip
  - pip install -U scikit-ci scikit-ci-addons
  - ci_addons --install ../addons

install:
  - if [ "${TRAVIS_CPU_ARCH}" == "arm64" ]; then
       pip install scikit-build;
    fi
  - ci install

script:
  - ci test

after_success:
  - ci after_test

deploy:
  # deploy-release
  - provider: script
    script: pwd && ls dist;echo "deploy-release" && ~/.pyenv/versions/${PYTHON_VERSION}/bin/twine upload -u $PYPI_USER -p $PYPI_PASSWORD --skip-existing dist/*
    skip_cleanup: true
    on:
      repo: ${TRAVIS_REPO_SLUG}
      tags: true
  # deploy-master
  - provider: script
    script: pwd && ls dist;echo "deploy-master" && echo "not implemented"
    skip_cleanup: true
    on:
      repo: ${TRAVIS_REPO_SLUG}
      branch: master

env:
  global:
    # PYPI_USER
    - secure: "Xejg5qGnAyo3G+/TaaAr1uHzDv9GLo3mxi6Aw/hZc9gF9lYix1TvkfE6GEBKdPgSLJSqF9NJrwKTt37XH1DjSRLG+qw6Bt1goi5Bkugdk+SC5qmMkvAoG0EKyD119WS4ObrpzqAFcOQqG+4F6iDkSuJLA+dzA3yAzTME4pkhr/2dn0krOSqIcTlgifPwhEaMgo//WRT2dEBM5dWoehXsEMD7VMOUyC0DlV15lKTPKSzTrDEUPU7UFnXgIqZM/brEPbWPQr5Jzgu7BeBk6bmPiiYeh28Cq2juzOzA+JWcGgJmXOfsImYwYuAWZrf0pkE0uQjLySvIBKT7phJv05eNqIxmv/wHK1BPcyMV+2IgFR4+f5ty6C4VUV0hT0HvHr3pMa/8A/5wSNCShEAMTHrwPM5VPWFJtUKTtS5+wwNQDI39MLk/vr9ZTo+y3WJHPaRR0nRpbA3nXFHSqoJJunoMyeI8x9cXZvJ9IENMxGuo3CfBT5RGZamfqSTgn6NjL51ArIMKpvUfm3tXTtlvCHenED1ZQeJI1nWZEalxl8pTyAZoA8S1+h8wraZrUPzhM0QuVpw7vZQeOYu2VSdHO46yxUWoQyb+JWrDTN7EC8vOl7QQzIQlqOWJB5uDJD7UlKKtneTHJrdfXvGxS/hf+Y+hFZK7r+/PDPS6aQjSNDyy+js="
    # PYPI_PASSWORD
    - secure: "iEHYaOC/yivDupsbRzohWYCwFMZbCfT2hYOM96akQtOfd1d37rqFCFjDKr3BNyvHyHzj+uNQ7IblynWAqu3cax2Z8b9YuIFXFAslD76IIgeIhxmi8jPtamMK0NBXam/LEL49EIVXUnwVZrWjnLcJxVaBHGS/9Ft3zWP5Gspa4G1yAJDhNfs+jrFipxO4DOBie9mGI2jFdbFRgcCYoY6Jo4y95zxUG1YF5e+8sUobLoBgVqyaJP4SP/Zu/4CEWMfJev8EjLBzzkoPwOU+hC09qwf2FQCvBXFrudpjPpY23WDFeKf+LcMoW9tIoUmP6UJcQibqHeidimrbo9jST0+wTo1NYjrvriKrlMho/QS4iYkd5N6DGUrhSXEMSiqfdMjVGDZ00wvCsT3DwqE9eG7K+Kw09enchjcZcggZIt9crqZPJg3GMdSwPYTlRpf2OQmE4OHL3pN5dSH5Es/sb0X1G6JQgB/2Ia9Aks2ywYEdzUZhbMqfLVx75bVS4bLfYMAMhE/j7NxpYaUlVkFhz3srLhnrYyAcvCQ6XF4cSeFfxD1ie62/qFIF/QH5u76t91uURHygvNdyJCNHhVJnnWgN9kPsJxfyfdOC2Dnrz/jJcw5irsgQVO2/K4iyGyBVoOqwwpymjoCkxB8capEoLRNLcwyQqCTBnMtGykyRYF2I7FA="
